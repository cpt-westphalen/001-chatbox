<!DOCTYPE html>
<body>
	<main id="chat-log">
		<p> teste</p>
	</main>

	<button id="create-new-user" onclick='newUser()'>Criar usuÃ¡rio</button>
	<input id="message-input-field" type="text-area" maxlength="140" autocomplete="off" style="width: 250px;">
	<button id="send-new-message" onclick='sendMessage()'>Enviar mensagem</button>
	<script type="text/javascript">

// console.log('js iniciado!')
const messageInput = document.getElementById("message-input-field");

// New user prototype.
class User {
	constructor(name,color){
		this.username = name;
		this.color = color;
		this.messages = [];
	}
	send(message) {
		const i = this.messages.length;
		this.messages[i] = message; //logs message on user
		console.log(this," has just sent ", this.messages[i]);
		chatbox.newMessage(message);
		// messageDisplay(this.username, this.color, texto);
	}
};

class Message {

	constructor(username,text) {
		const now = new Date();
		this.date = [`${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`,`${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`];
		this.author = username;
		this.textContent = text;
		this.id = users.id[username].messages.length;
	}

	get timestamp() {
		return `${this.date[0]} ${this.date[1]}`;
	}

	edit(text) {
		users.id[this.author].messages[this.id].textContent = text;
		this.textContent = text;
	}
}

function newUser() { 
	users.add('teste', '#ffffff');
}

function sendMessage() {
	const text = messageInput.value;
	messageInput.value = "";
	const username = "teste";
	const message = new Message(username,text);
	users.id[username].send(message);
	console.log("new message created and sent to user object");
}

const users = { 
	id: {}, //this is where every new User() is stored. Access it thru users.id[name]
	add(name, color) {
		//this method creates a new User() and stores it into id[name].
		users.id[name] = new User(name,color);
		console.log("New user was created successfully.");
		console.log("The global Users object is now: ", users);
	},
};

const chatbox = {
	log: [],
	newMessage(message) {
		this.log.unshift(message);
		console.log("New message added to chatbox log");
	},
	update() {
		if(this.log[0]) {
			console.log("Updating chat... last message was: ", this.log[0]);
			setTimeout(()=>{this.update()}, 10000);
		} else {
			console.log("No new messages yet.");
			setTimeout(()=>{this.update()}, 20000);
		}
	}
};

chatbox.update();

</script>
</body>